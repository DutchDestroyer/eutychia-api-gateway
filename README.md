# Go API Server for openapi

This api is a test version to connect the backend and frontend

## Overview
This server was generated by the [openapi-generator]
(https://openapi-generator.tech) project.
By using the [OpenAPI-Spec](https://github.com/OAI/OpenAPI-Specification) from a remote server, you can easily generate a server stub.  
-

To see how to make this your own, look here:

[README](https://openapi-generator.tech)

- API version: 1.0.0
- Build date: 2020-12-12T10:20:28.723281+01:00[Europe/Berlin]


### Running the server
To run the server, follow these simple steps:

```
go run main.go
```

To run the server in a docker container
```
docker build --network=host -t openapi .
```

Once image is built use
```
docker run --rm -it openapi 
```

### Docker
- In the terminal, navigate to the docker folder, run docker-compose up -d --remove-orphans

### DB migrations

#### Creating a new db migration
- From the root of the project, run migrate create -ext sql -dir resources/postgres/dbmigrations -seq <NameOfMigrationFile>
- This should create 2 db migration files, one up and one down.
- In the up file, write the db migration
- In the down file, write the rollback plan

#### Executing the db migration
- Start Docker 
- In the terminal, navigate to the root folder of the project
- Run `migrate -path resources/postgres/dbmigrations -database "postgresql://postgres:postgres@localhost5432/eutychia?sslmode=disable" -verbose up`
- If something went wrong, you need to force the last working version of the db:
`migrate -path resources/postgres/dbmigrations -database "postgresql://postgres:postgres@localhost5432/eutychia?sslmode=disable" force VERSION` 
- If you want to migrate down, run `migrate -path resources/postgres/dbmigrations -database "postgresql://postgres:postgres@localhost5432/eutychia?sslmode=disable" down <NumberOfDownMigrations>` 
